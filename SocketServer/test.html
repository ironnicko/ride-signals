<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Ride WebSocket Test</title>
        <style>
            body {
                font-family: sans-serif;
                padding: 20px;
            }
            input,
            button {
                margin: 5px;
            }
            pre {
                background: #eee;
                padding: 10px;
                height: 200px;
                overflow: auto;
            }
        </style>
    </head>
    <body>
        <h2>üö¥ Ride WebSocket Test</h2>

        <div>
            <label>JWT Token:</label><br />
            <input id="token" size="80" placeholder="Bearer ..." />
        </div>

        <div>
            <label>Ride Code:</label><br />
            <input id="rideCode" value="testRide" />
        </div>

        <div>
            <button id="connectBtn">Connect</button>
            <button id="joinBtn">Join Ride</button>
            <button id="leaveBtn">Leave Ride</button>
            <button id="sendLocBtn">Send Location</button>
            <button id="sendSigBtn">Send Signal</button>
        </div>

        <h3>Logs</h3>
        <pre id="log"></pre>

        <script>
            let ws = null;

            const log = (...args) => {
                const pre = document.getElementById("log");
                pre.textContent += args.join(" ") + "\n";
                pre.scrollTop = pre.scrollHeight;
            };

            document.getElementById("connectBtn").onclick = () => {
                const token = document.getElementById("token").value;
                if (!token) return alert("Enter JWT token first");
                const url = new URL("https://192.168.1.4/socket/ws"); // change port if needed
                url.searchParams.append("token", token);

                ws = new WebSocket(url);

                ws.onopen = () => log("‚úÖ Connected");
                ws.onclose = () => log("‚ùå Disconnected");
                ws.onerror = (err) => log("‚ö†Ô∏è Error", err);

                ws.onmessage = (event) => {
                    log("üì© Message:", event.data);
                };
            };

            document.getElementById("joinBtn").onclick = () => {
                if (!ws || ws.readyState !== WebSocket.OPEN)
                    return log("Not connected");
                const rideCode = document.getElementById("rideCode").value;
                const payload = {
                    event: "joinRide",
                    data: { rideCode, fromUser: "testUser" },
                };
                ws.send(JSON.stringify(payload));
                log("‚û°Ô∏è Sent joinRide", JSON.stringify(payload));
            };

            document.getElementById("leaveBtn").onclick = () => {
                if (!ws || ws.readyState !== WebSocket.OPEN)
                    return log("Not connected");
                const rideCode = document.getElementById("rideCode").value;
                const payload = {
                    event: "leaveRide",
                    data: { rideCode, fromUser: "testUser" },
                };
                ws.send(JSON.stringify(payload));
                log("‚û°Ô∏è Sent leaveRide", JSON.stringify(payload));
            };

            document.getElementById("sendLocBtn").onclick = () => {
                if (!ws || ws.readyState !== WebSocket.OPEN)
                    return log("Not connected");
                const rideCode = document.getElementById("rideCode").value;
                const payload = {
                    event: "sendLocation",
                    data: { rideCode, location: { lat: 12.34, lng: 56.78 } },
                };
                ws.send(JSON.stringify(payload));
                log("‚û°Ô∏è Sent sendLocation", JSON.stringify(payload));
            };

            document.getElementById("sendSigBtn").onclick = () => {
                if (!ws || ws.readyState !== WebSocket.OPEN)
                    return log("Not connected");
                const rideCode = document.getElementById("rideCode").value;
                const payload = {
                    event: "sendSignal",
                    data: {
                        rideCode,
                        signalType: "horn",
                        location: { lat: 1, lng: 2 },
                    },
                };
                ws.send(JSON.stringify(payload));
                log("‚û°Ô∏è Sent sendSignal", JSON.stringify(payload));
            };
        </script>
    </body>
</html>
